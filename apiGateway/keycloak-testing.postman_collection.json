{
  "info": {
    "_postman_id": "f3b5a23e-9ac7-48d7-a93e-4c88b4d3e9b2",
    "name": "degreework-microservice-with-keycloak",
    "description": "Colecci√≥n para probar DegreeWork con Keycloak a trav√©s del API Gateway",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "keycloak_url",
      "value": "http://localhost:9090",
      "type": "string"
    },
    {
      "key": "realm",
      "value": "trabajos-grado",
      "type": "string"
    },
    {
      "key": "client_id",
      "value": "api-gateway",
      "type": "string"
    },
    {
      "key": "client_secret",
      "value": "TU_CLIENT_SECRET",
      "type": "string"
    },
    {
      "key": "access_token",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "üîê 1. Obtener Token Keycloak (Docente)",
      "request": {
        "method": "POST",
        "header": {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        "body": {
          "mode": "urlencoded",
          "urlencoded": [
            {
              "key": "client_id",
              "value": "{{client_id}}",
              "type": "text"
            },
            {
              "key": "client_secret",
              "value": "{{client_secret}}",
              "type": "text"
            },
            {
              "key": "grant_type",
              "value": "password",
              "type": "text"
            },
            {
              "key": "username",
              "value": "docente@unicauca.edu.co",
              "type": "text"
            },
            {
              "key": "password",
              "value": "password",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token",
          "host": ["{{keycloak_url}}"],
          "path": ["realms", "{{realm}}", "protocol", "openid-connect", "token"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "var jsonData = pm.response.json();",
              "pm.collectionVariables.set(\"access_token\", jsonData.access_token);",
              "console.log(\"Token obtenido: \" + jsonData.access_token);"
            ]
          }
        }
      ]
    },
    {
      "name": "üîê 2. Obtener Token Keycloak (Estudiante)",
      "request": {
        "method": "POST",
        "header": {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        "body": {
          "mode": "urlencoded",
          "urlencoded": [
            {
              "key": "client_id",
              "value": "{{client_id}}",
              "type": "text"
            },
            {
              "key": "client_secret",
              "value": "{{client_secret}}",
              "type": "text"
            },
            {
              "key": "grant_type",
              "value": "password",
              "type": "text"
            },
            {
              "key": "username",
              "value": "estudiante@unicauca.edu.co",
              "type": "text"
            },
            {
              "key": "password",
              "value": "password",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{keycloak_url}}/realms/{{realm}}/protocol/openid-connect/token",
          "host": ["{{keycloak_url}}"],
          "path": ["realms", "{{realm}}", "protocol", "openid-connect", "token"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "var jsonData = pm.response.json();",
              "pm.collectionVariables.set(\"access_token\", jsonData.access_token);",
              "console.log(\"Token obtenido: \" + jsonData.access_token);"
            ]
          }
        }
      ]
    },
    {
      "name": "üö´ Probar SIN Token (deber√≠a fallar 401)",
      "request": {
        "method": "GET",
        "header": {},
        "url": {
          "raw": "{{base_url}}/api/degreeworks",
          "host": ["{{base_url}}"],
          "path": ["api", "degreeworks"]
        }
      }
    },
    {
      "name": "‚úÖ Listar Todos los DegreeWorks (con Token)",
      "request": {
        "method": "GET",
        "header": {
          "Authorization": "Bearer {{access_token}}"
        },
        "url": {
          "raw": "{{base_url}}/api/degreeworks",
          "host": ["{{base_url}}"],
          "path": ["api", "degreeworks"]
        }
      }
    },
    {
      "name": "‚úÖ Obtener DegreeWork por ID",
      "request": {
        "method": "GET",
        "header": {
          "Authorization": "Bearer {{access_token}}"
        },
        "url": {
          "raw": "{{base_url}}/api/degreeworks/1",
          "host": ["{{base_url}}"],
          "path": ["api", "degreeworks", "1"]
        }
      }
    },
    {
      "name": "‚úÖ Listar DegreeWorks por Docente",
      "request": {
        "method": "GET",
        "header": {
          "Authorization": "Bearer {{access_token}}"
        },
        "url": {
          "raw": "{{base_url}}/api/degreeworks/docente/profesor@unicauca.edu.co",
          "host": ["{{base_url}}"],
          "path": ["api", "degreeworks", "docente", "profesor@unicauca.edu.co"]
        }
      }
    },
    {
      "name": "‚úÖ Listar DegreeWorks por Estudiante",
      "request": {
        "method": "GET",
        "header": {
          "Authorization": "Bearer {{access_token}}"
        },
        "url": {
          "raw": "{{base_url}}/api/degreeworks/estudiante/estudiante@unicauca.edu.co",
          "host": ["{{base_url}}"],
          "path": ["api", "degreeworks", "estudiante", "estudiante@unicauca.edu.co"]
        }
      }
    },
    {
      "name": "üìù Registrar DegreeWork (Investigaci√≥n)",
      "request": {
        "method": "POST",
        "header": {
          "Content-Type": "application/json",
          "Authorization": "Bearer {{access_token}}"
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"titulo\": \"Sistema IoT para monitoreo ambiental\",\n  \"modalidad\": \"INVESTIGACION\",\n  \"fechaActual\": \"2025-10-29\",\n  \"directorId\": 1,\n  \"estudiantesIds\": [1, 2],\n  \"codirectoresIds\": [3],\n  \"objetivoGeneral\": \"Desarrollar un sistema de monitoreo ambiental basado en IoT\",\n  \"objetivosEspecificos\": [\n    \"Recolectar datos de temperatura y humedad\",\n    \"Dise√±ar una arquitectura modular de sensores\",\n    \"Implementar una interfaz web de monitoreo\"\n  ],\n  \"estado\": \"FORMATO_A\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/degreeworks/registrar",
          "host": ["{{base_url}}"],
          "path": ["api", "degreeworks", "registrar"]
        }
      }
    },
    {
      "name": "üìù Registrar DegreeWork (Pr√°ctica Profesional)",
      "request": {
        "method": "POST",
        "header": {
          "Content-Type": "application/json",
          "Authorization": "Bearer {{access_token}}"
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"titulo\": \"Implementaci√≥n de un sistema de gesti√≥n documental\",\n  \"modalidad\": \"PRACTICA_PROFESIONAL\",\n  \"fechaActual\": \"2025-10-29\",\n  \"directorId\": 2,\n  \"estudiantesIds\": [5],\n  \"objetivoGeneral\": \"Desarrollar un sistema web para la gesti√≥n de documentos empresariales\",\n  \"objetivosEspecificos\": [\n    \"Analizar los procesos documentales actuales\",\n    \"Dise√±ar la base de datos\",\n    \"Implementar el m√≥dulo de carga y consulta\"\n  ],\n  \"estado\": \"FORMATO_A\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/degreeworks/registrar",
          "host": ["{{base_url}}"],
          "path": ["api", "degreeworks", "registrar"]
        }
      }
    },
    {
      "name": "üîÑ Actualizar DegreeWork",
      "request": {
        "method": "PUT",
        "header": {
          "Content-Type": "application/json",
          "Authorization": "Bearer {{access_token}}"
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"titulo\": \"Sistema IoT de monitoreo ambiental (actualizado)\",\n  \"objetivoGeneral\": \"Optimizar el sistema IoT existente para mejorar su eficiencia energ√©tica\",\n  \"objetivosEspecificos\": [\n    \"Mejorar el consumo de energ√≠a de los sensores\",\n    \"Optimizar la transmisi√≥n de datos\",\n    \"Actualizar el dashboard con m√©tricas energ√©ticas\"\n  ],\n  \"correcciones\": \"Actualizar los diagramas UML\",\n  \"estado\": \"ANTEPROYECTO\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/degreeworks/1",
          "host": ["{{base_url}}"],
          "path": ["api", "degreeworks", "1"]
        }
      }
    },
    {
      "name": "‚ùå Eliminar DegreeWork",
      "request": {
        "method": "DELETE",
        "header": {
          "Authorization": "Bearer {{access_token}}"
        },
        "url": {
          "raw": "{{base_url}}/api/degreeworks/1",
          "host": ["{{base_url}}"],
          "path": ["api", "degreeworks", "1"]
        }
      }
    },
    {
      "name": "üîç Probar Roles - Acceso a Evaluaciones (solo DOCENTE)",
      "request": {
        "method": "GET",
        "header": {
          "Authorization": "Bearer {{access_token}}"
        },
        "url": {
          "raw": "{{base_url}}/api/evaluaciones/test",
          "host": ["{{base_url}}"],
          "path": ["api", "evaluaciones", "test"]
        }
      }
    }
  ]
}